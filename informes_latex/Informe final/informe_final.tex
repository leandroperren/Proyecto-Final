\documentclass[a4paper,12pt,oneside]{book}
\usepackage[latin1]{inputenc}
\usepackage[spanish]{babel}
\usepackage{calc}
\usepackage{fancyhdr}
\usepackage[pdftex]{graphicx}
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{graphics}
\usepackage{float}
\usepackage{geometry}
\geometry{
a4paper,
layout=a4paper,
left=2.5cm,
right=2cm,
bottom=2.5cm,
top=2.5cm }
\renewcommand{\baselinestretch}{1.2}

%\usepackage{mathptmx} %Times

\usepackage{xcolor,colortbl}
\definecolor{light-grey}{gray}{0.9}
\definecolor{medium-grey}{gray}{0.5}
\definecolor{charcoal}{HTML}{333333}

\usepackage{mathrsfs} 

\pagestyle{fancy}
% Header
\lhead{\textsc{\footnotesize Tesis de Grado}}
\rhead{\textit{\footnotesize \leftmark}}
% Footer
\lfoot{\footnotesize \textit{Meurzet, Matías - Perren, Leandro}}
\cfoot{}
\rfoot{\footnotesize \thepage}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

\usepackage{cite} % para contraer referencias
\usepackage{enumerate} % enumerados
\usepackage{url} % direcciones url web para citas y referencias bibliograficas

%\renewcommand\theenumii{\theenumi.\arabic{enumii}}
\usepackage{titling}

\pretitle{
	\begin{center}
	\LARGE
	\vspace{-3cm}
	\includegraphics[scale=0.3]{img/fich_logo_classic}\\[\bigskipamount]
}
\posttitle{	\end{center}}


\begin{document}

%==============================================================================
%
%	PORTADA DE TESIS
%
%==============================================================================
\title{
	\Large{\textcolor{charcoal}{Universidad Nacional del Litoral}\\
	Facultad de Ingeniería y Ciencias Hídricas}\\ \vspace{15mm}
	\huge{\textbf{Desarrollo de métodos inteligentes para la detección y clasificación de ronquidos\\ CAMBIAR!}}\\ \vspace{15mm}
	\Large{Ingeniería en Informática Aplicada} \vspace{15mm}
}

\author{
	\textbf{Autores:} Meurzet, Matías - Perren, Leandro\\
	\textbf{Director y Co-Director:} Milone, Diego - Albornoz, Marcelo \\ \\
	\small{Santa Fe, Argentina}
}

\date{\small{\today}}

\maketitle


%==============================================================================
%
%	INDICES DE CONTENIDO, FIGURAS Y TABLAS RESPECTIVAMENTE
%
%==============================================================================
\tableofcontents
\thispagestyle{empty}

\listoffigures
\thispagestyle{empty}

\listoftables
\thispagestyle{empty}


%==============================================================================
%
%	RESUMEN
%
%==============================================================================
\newpage

\chapter*{Resumen}
\thispagestyle{empty}

En la actualidad existen distintas herramientas de uso doméstico para la detección de ronquidos, las cuales van desde elementos diseñados especialmente, como almohadas inteligentes o pulseras, hasta diferentes aplicaciones para dispositivos móviles. Todas ellas consisten del análisis de una señal capturada por medio del micrófono de tal dispositivo.

La limitación de estos métodos es que solamente realizan un análisis de la señal en busca de cambios bruscos del nivel de energía, provocando que las aplicaciones sean poco robustas a los ruidos que se pueden presentar en un entorno cotidiano bajo condiciones normales, entendiéndose por tal escenario a una habitación personal donde hay movimiento de gente y de otros provenientes de distintos objetos, tanto internos como externos a la habitación.

En la presente tesis se propone desarrollar una aplicación Android capaz de detectar episodios de ronquidos capturados por medio del micrófono del dispositivo, presentando características fundamentales como la robustez frente al ruido, óptimo uso de procesador y memoria, además de un consumo equilibrado de la batería.

Para ello se presenta un método basado en el cálculo del período fundamental ($T_0$ de aquí en adelante) por medio de la autocorrelacion, este método recorrerá por ventaneo en tiempo real toda la señal capturada por el dispositivo y determinará si el $T_0$ de esa ventana se encuentra dentro de un rango determinado para que sea considerado ronquido. 

Este rango de $T_0$ se determina mediante la extracción de una gran cantidad de ronquidos de señales limpias en formato \textbf{*.EDF} provistas por un especialista en trastornos de sueño y que  contienen la grabación de toda una noche de sueño (6 o 7 horas de duración), correspondientes a personas de ambos sexos.

La base del método que se propone esta en la naturaleza cuasi-periódica que los ronquidos presentan y que los ruidos no, a su vez la ventaja de utilizar el $T_0$ se basa en que únicamente se analiza temporalmente la señal y que se puede utilizar en señales de baja frecuencia (100Hz), lo que genera un costo computacional, de almacenamiento y de consumo energético mucho menor al de otros métodos que utilizan además características frecuenciales.

Los resultados que se obtuvieron de las pruebas de la aplicación arrojaron buenas tasas de aciertos, superando el 80\% y en algunos casos llegando a valores cercanos al 100\%, tanto para pruebas realizadas sobre señales limpias como para señales capturadas en entornos cotidianos conteniendo una gran cantidad de ruidos.

\newpage


%==============================================================================
%
%	CAPITULO 1 - INTRODUCCION
%
%==============================================================================
\setcounter{chapter}{0}

\chapter{Introducción}
\thispagestyle{empty}
\section{Motivación} 
El ronquido es un sonido respiratorio producido durante el sueño pudiendo ser inspiratorio, espiratorio o bien ocupar todo el ciclo respiratorio. El surgimiento se debe a que el flujo de aire encuentra una obstrucción al pasar por detrás de la boca y la nariz, en donde la lengua y la parte superior de la garganta se encuentran con el paladar blando y la úvula. El choque de estas estructuras sumado al paso de la respiración determina la presencia del ronquido [1].

La importancia de la detección de esta patología excede el simple hecho de evitar roncar por las noches, esta situación puede ocasionar trastornos sociales al impedir el sueño de aquellos que rodeen al roncador, así como también producir el conocido Síndrome de Apneas Obstructivas del Sueño (SAOS). De acuerdo con lo anteriormente mencionado, se pueden encontrar 2 (dos) tipos o clases de ronquidos: simple, el cual no molesta a los acompañantes, o bien alto habitual (o social), debido a que suele afectar a un eventual acompañante o conviviente. Ambos casos no presentan resistencias de la vía aérea superior [2][3]. 

Actualmente existen numerosas herramientas y dispositivos que permiten detectar esta patología en una persona. Dentro de éstas se encuentran diferentes aplicaciones disponibles para dispositivos móviles (smartphones) que cuenten con sistema operativo (OS) Android [6] o AppleiOS [7], ejemplos de las mismas son las aplicaciones SnoreClock y AntiSnore para Android y, AntiRonquidos y SnoreLab para dispositivos iPhone. Otros dispositivos que se encuentran disponibles hoy en día y que suelen ser menos frecuentes y más costosos son, por ejemplo, Snore-detection pillow [9] o almohada detectora de ronquidos, las pulseras detectoras, las cuales son colocadas en la muñeca como si se tratara de un reloj, además de una cama inteligente (The Starry Night Sleep Technology Bed) [8] que dispone de un dispositivo de detección y ajuste de la posición de la cabeza para que los sonidos cesen. Algunos de los dispositivos mencionados para la detección de esta patología (principalmente dispositivos móviles) están basados en un simple análisis de la señal de audio digital, capturada por el dispositivo, buscando cambios bruscos que superen un umbral dado de energía, indicando así la presencia de ronquido.

La problemática de los métodos actuales mencionados, radica en el hecho de que no cualquier sonido que supere cierto umbral de energía es un ronquido. Este problema se puede presentar de manera habitual cuando un individuo realiza la grabación en un ambiente natural como una habitación, en la cual se pueden adicionar muchos ruidos. Se entiende como ruido toda aquella información no deseada que se encuentre contenida en la señal bajo análisis, generando inconvenientes, pudiendo ser estos tanto externos (colectivos, motos, vecinos, etc.) como internos (charlas, música, TV, cierre brusco de puerta, etc.) incorporando una gran cantidad de energía a la señal, siendo eventualmente detectados como ronquido. 

Desde esta problemática, se propone desarrollar una aplicación para dispositivos móviles la cual utilizando métodos más inteligentes que los actuales, sea capaz de reconocer y clasificar ronquidos, a partir de la captura de una señal de audio digital mediante el micrófono de un dispositivo móvil (smartphone), realizando el análisis de la misma y bajo la aplicación de diversos conocimientos: 

\begin{enumerate}
	\item Mecánica de la respiración.
	\item Fisiología y anatomía de la vía aérea superior (VAS).
	\item Procesamiento de señales.
	\item Programación en plataforma Android (basado en Java).
\end{enumerate}

La importancia de la mecánica de la respiración [5] y de la fisiología y anatomía de la vía aérea superior (VAS) [5]: fosas nasales, faringe y laringe, reside en el conocimiento funcional del aparato respiratorio para comprender por qué se produce el ronquido. El funcionamiento incorrecto de alguna de sus partes provoca la oclusión intermitente de la VAS que predispone el desarrollo de la roncopatía. La programación en plataforma android [12], la cual se compone de Java [13] y su propio entorno de desarrollo o SDK (del inglés Software \-Development Kit) [14], permitiendo la creación de aplicaciones para ésta plataforma, conocidas como aplicaciones nativas. Existen otras variantes para la creación de aplicaciones, pero exceden el alcance de éste proyecto final. Mediante la utilización del SDK y el lenguaje Java, se manifiestan una infinidad de opciones más que suficientes para el alcance de este trabajo final, como ser, bases de datos, creación de clases y funciones para su procesamiento y creación de interfaces orientadas al usuario, entre otras. El procesamiento de señales [10] permite la manipulación matemática de la señal para modificarla, mejorarla y extraer información en algún sentido con el fin de obtener las características necesarias para una posterior detección. 

El método que se desarrolla en esta tesis presenta el desafío de lograr una detección de ronquidos con la mayor tasa de aciertos posible. Para ello fue preciso realizar un estudio exhaustivo de las características temporales de diferentes ronquidos de manera tal que la detección, aún en presencia de ruido, presente una gran robustez. Al estudiar los diferentes ronquidos se debió tener presente las condiciones del entorno en el que se captura la señal, ya que esto tiene incidencia directa en la amplia variedad de ruidos que pueden afectarla. 

Se pretende mediante este trabajo proporcionar una alternativa inteligente respecto a los métodos actuales de detección de ronquidos, además de ser un punto inicial para futuros desarrollos tecnológicos, no necesariamente software sobre teléfonos inteligentes (smart\-phones), sino también para otros dispositivos que pretendan incorporar inteligencia a fin de detectar el ronquido para llevar a cabo alguna acción determinada. A su vez se espera que sirva de base sólida para futuros trabajos que logren ampliar su alcance llevándolo a la detección y clasificación de otros trastornos como es el caso del SAOS[5]. 

\section{Estado del arte}
En esta sección se describe el estado actual de trabajos y aplicaciones que tienden a cumplir objetivos similares a los que se persiguen en esta tesis. Para ello primero se describen una serie de trabajos de investigación de carácter científico en los cuales se trabaja en base a señales capturadas en estudios del sueño, mediante las cuales se extraen y analizan segmentos de ronquidos y tienen por objeto caracterizar a los mismos tanto temporalmente como frecuencialmente. Por otra parte se analiza el desempeño de algunas de las aplicaciones Android disponibles actualmente indicando sus falencias y posibles mejoras.

Comenzando por los trabajos de investigación, en [15] describen al estado del arte actual de los procedimientos de análisis del ronquido. Los métodos que se mencionan son los cuestionarios del ronquido, nasoendoscopía durante el sueño inducido, maniobras de Müller, manometría de la vía aérea superior, rinomanometría y rinomanometría acústica, técnicas de imagen, medidas acústicas, monitores-analizadores de ronquido y finaliza con otros métodos para analizar el ronquido. De todas ellas lo más interesante son las medidas acústicas, donde se realizan 3 análisis: intensidad, frecuencia y regularidad del ronquido.
Por otro lado, en [16] hacen una revisión de los conocimientos científicos con respecto a la evaluación acústica del ronquido, y de ésta manera hacer frente a tópicos como por ejemplo características físicas de los sonidos de ronquidos generados en la vía aérea superior, principios de la medición acústica del sonido, análisis avanzado y modelado de sonidos de ronquidos, evaluación acústica de ronquidos respecto a resultados clínicos y además de cuestiones sin resolver que se plantean para futuras investigaciones. La información más relevante para este trabajo se encuentra en la medición acústica del sonido, donde se extraen características de los mismos, y por otro lado también el apartado de análisis avanzado y modelado, donde se utilizan métodos avanzados como por ejemplo codificación por predicción lineal (LPC, del inglés Linear Predictive Coding), transformada de Fourier para análisis espectral, análisis de onditas (wavelets), modelos ocultos de Markov, análisis en la distribución de energía, determinación del período fundamental (como el tono) y por último la utilización de estadísticas de alto orden. 
En otro trabajo, específicamente en [17] analizaron grabaciones en audio digital de distintos roncadores, en específico 42 con distintos grados de severidad de apneas (leve, moderado y grave) y 15 roncadores sin apneas. A partir de allí, extrajeron diversas características con las que se determina una norma de variación y se comparan entre pacientes con y sin OSAS (Síndrome de Apnea Obstructora del Sueño, del inglés Obstructive Sleep Apnea Syndrome). Entre las características extraídas se encuentran la densidad espectral de potencia (PSD, del inglés Power Spectral Density) calculada con el método de Welch y con ventanas de Hanning, además para cada segmento, potencia promedio, tasa de cruces por cero (ZCR, del inglés Zero-Crossing Rate), frecuencia del pico espectral con la menor frecuencia (Fo), frecuencia del pico con máxima potencia (Fp) y entropía espectral (SE, del inglés Spectral Entropy) usada para ver que tan plano es la PSD. Además se realiza un análisis estadístico mediante medianas de las características del sonido de ronquido para cada clase de episodio, como por ejemplo no-apneico, hipopneico y post-apneico. Por otro lado también se realiza un análisis de regresión y clasificación donde se introduce un Indice de Apnea-Hipopnea (AHI, del inglés Apnea Hypopnea Index) y asume 2 grupos de roncadores, con y sin apneas, introduciendo además otro indicador que es la norma de variación total (TVi, del inglés Total Variation) para cada característica individual. Por último se verifican los métodos mediante validación cruzada de la forma leave-one-out.
En otro estudio, en [18] hacen un pre-procesamiento de la señal acústica capturada, realizando una transformación invariante del dominio mediante wavelets (onditas) y de ésta manera se realiza una mejora de la señal de ronquido a través de un nivel de umbral de correlación dependiente (LCD, del inglés Level Correlation Dependent) y la identificación de ronquido a través de un detector de actividad de ronquido (SA, del inglés Snore Activity).
Por último, en [19] proponen la utilización de un algoritmo automático y sin supervisión para la detección de ronquidos. Uno de los algoritmos utilizados es el de cuadro vertical (V-Box) que se encarga de identificar los episodios de actividad sonora. De estos episodios se extrae la distribución de energía en la sub banda de 500Hz y otras características como cruces por cero (ZCR), transformada de Fourier de tiempo corto (STFT, del inglés Short Time Fourier Transform), matriz de covarianza y un vector con la media de las características de los ronquidos. Con estos datos se utiliza un algoritmo de clustering borroso de c-medias (FCM, del inglés Fuzzy c-Means clustering) para etiquetar los episodios de sonido como ronquido, respiración y ruido. 

La mayoría de los trabajos que se mencionan en el párrafo anterior si bien presentan métodos y procedimientos interesantes no pueden ser aplicados totalmente a los fines de esta tesis, en principio porque no están enfocados directamente a la detección de episodios de ronquidos, sino a caracterizar ronquidos ya extraídos de señales con alta resolución permitiéndoles extraer en su mayoría características frecuenciales (formantes, wavelets, Fourier, etc.), al mismo tiempo que algunos trabajos realizan comparaciones entre ronquidos simples y ronquidos apneicos, lo cual excede el alcance de este trabajo o bien describen diferencias puntuales de ciertas características dependiendo si el ronquido se produce en alguna parte especial de la vía aérea superior. Aun así se rescatan cuestiones interesantes que tienen que ver con la naturaleza cuasi-periódica de los ronquidos permitiendo trabajar temporalmente con características como la energía y el período fundamental, y además rescatar procedimientos relacionados al ventaneo que se describe en uno de los trabajos.

En cuanto a las aplicaciones, a continuación se describen algunas desarrolladas para Android disponibles al momento en la \textit{PlayStore}. Una de ellas es \textbf{\textit{SnoreClock}}, la misma presenta una interface sencilla que dispone de los controles elementales para comenzar, detener, reproducir, avanzar y retroceder la grabación. La aplicación presenta una gráfica en tiempo real de lo que va capturando, una vez finalizada la captura se puede recorrer la señal y hasta reproducir segmentos de la misma. Los segmentos que etiqueta como posibles ronquidos los marca en la gráfica en color rojo. El problema de esta aplicación es que etiqueta como posibles ronquidos todo el sonido que supere un determinado umbral de energía durante un cierto período de tiempo, tal como lo define en la información oficial de la app: \textit{``SnoreClock registra todo el ruido mientras duermes y muestra con barras rojas los momentos en los que es posible que hayas roncado"} [20]. Es por esto que el funcionamiento no es para nada preciso reconociendo que marca rangos temporales en los que posiblemente el usuario no ha roncado. Otra aplicación disponible es \textbf{\textit{Dream Watcher - Anti ronquidos}} [21], donde la misma realiza una monitorización de ronquidos y ruidos nocturnos. Dream Watcher va analizando la señal mientras la captura, extrayendo aquellos episodios que detecta como posibles ronquidos guardando esos segmentos separadamente como archivos de audios los cuales pueden ser reproducidos. Además se puede ver en la figura \ref{figura:android_app} una captura en la que se resalta un umbral marcado en color rojo, donde cada vez que la señal supera esa línea cuenta un ronquido. Esta aplicación presenta el mismo problema que la anterior ya que cualquier ruido en el ambiente se lo marca como ronquido, es por esto que en la información oficial de la App sugiere que el segmento esta disponible para escucharse de manera que sea el usuario quien decida si es un ronquido o no en base a lo que el escucha. Además de las aplicaciones aquí mencionadas, existen muchas más en la tienda de Android, donde la mayoría presentan las mismas limitaciones y en ningún caso mencionan que sucede con ruidos externos y, en otros casos son más generales, dejando de lado el enfoque hacia ronquidos.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.3]{img/dream_watcher}	
	\caption{Aplicación Dream Watcher de la PlayStore.}
	\label{figura:android_app}
\end{figure}


\section{Objetivos}
\subsection{Objetivos Generales} 
Desarrollar una aplicación Android capaz de detectar segmentos con ronquidos a partir de una grabación de audio digital capturada por medio del micrófono del dispositivo presentando alta robustez frente a ruidos en condiciones ambientales normales.

\subsection{Objetivos Específicos}
\begin{itemize}  
    \item Caracterizar temporalmente distintos segmentos de ronquidos.
	\item Desarrollar un método para la detección/clasificación de ronquidos. 
	\item Incorporar el método a una aplicación Android capaz de detectar segmentos de ronquidos.
	\item Lograr una tasa de aciertos en la detección de ronquidos superior a la que presentan ciertas aplicaciones. 
\end{itemize}

\section{Alcances}
El desarrollo de este trabajo implica definir el alcance del método de detección aquí propuesto como también de las características que la aplicación Android debe cumplir. 

Por el lado del método de detección, para el estudio de las características temporales se trabajó con señales EDF obtenidas mediante el sistema médico ApneaLink, las cuales tienen características equivalentes, pudiendo mencionar: 
 
\begin{itemize}
	\item Frecuencia de muestreo (en Hz). 
	\item Precisión en bits para cuantificación. 
	\item Duración en horas similares (con desvío de +/- 2 horas) 
\end{itemize}

El análisis de las características temporales se limitará al cálculo del $T_0$ (período fundamental), se considerarán posibles diferencias entre ronquidos de personas de distintos sexos, y se dejarán de lado otras características de los individuos como el peso y la edad, ya que no se dispone de esa información en las señales EDF. A su vez, el método de detección se desarrollará específicamente para ronquidos y se dejará de lado el caso particular de los SAOS y demás trastornos del sueño, ya que se trabajará solamente con el canal de ronquido de tales grabaciones.

Por el lado de la aplicación Android, esta permitirá capturar una señal digital por medio del micrófono del dispositivo, la cual será analizada tomando ventanas de 5 minutos determinando si en dicho segmento se producen ronquidos. La aplicación permitirá acceder a dos tipos de reportes, uno gráfico y otro en modo texto donde se presentarán los resultados. En ellos se indicarán la hora en que se producirán los eventos y una estimación de la intensidad determinando dos niveles. A su vez la aplicación permitirá enviar vía correo electrónico estos reportes a un médico que pudiera estar interesado en los análisis.

El desarrollo de esta aplicación movil cumplirá con las siguientes características: 
\begin{itemize}
	\item Robustez 
	\item Sencillez
	\item Eficiencia
	\item Óptimo consumo de batería
	\item Óptimo uso de la capacidad de almacenamiento
\end{itemize} 

\section{Organización del Proyecto Final}
Esta tesis presenta la siguiente estructura:
\begin{itemize}
	\item En el presente capítulo se describió la motivación de este desarrollo y el problema que será abordado. Se presenta una revisión del estado del arte de dispositivos y aplicaciones destinados a detectar ronquidos, como también se describen trabajos investigativos orientados a la detección de los mismos utilizando señales obtenidas en estudios del sueño. Luego se presentan los objetivos y alcances, y finalmente, se describe la estructura de capítulos.
	\item En el Capítulo 2 se describe el método de detección desarrollado en este proyecto final. Primeramente se describe la extracción de ronquidos y calculo del $T_0$ de las señales limpias EDF (canal de Ronquido) y se determina en base a ellos un rango de decisión. Posteriormente se capturan diferentes sonidos no deseados y se comparan los $T_0$ con los de los segmentos de ronquidos. Para finalizar se presentan las tasas de acierto del algoritmo detector desarrollado en Matlab utilizando las señales limpias EDF.
	\item En el Capítulo 3 se presenta el desarrollo de la aplicación Android. Primeramente se desarrollan las distintas etapas propuestas por la Ingeniería de Software. Luego se calculan las tasas de aciertos de la aplicación realizando distintas pruebas tanto con señales limpias (canal de Ronquido en EDF) como en entornos cotidianos propensos a un alto contenido de ruidos.
	\item El Capítulo 4 dispone de las conclusiones particulares y generales como también de propuestas de futuros trabajos que podrían derivar del presente.
\end{itemize}


%==============================================================================
%
%	CAPITULO 2 - METODOS
%
%==============================================================================
\chapter{Desarrollo del Sistema de Detección}
\thispagestyle{empty}
\section{Método de detección de ronquidos por medio de Período Fundamental ($T_0$)}
Para este trabajo se dispuso de una cantidad de 23 señales de formato EDF provistas por un médico especializado en trastornos de sueño. Cada una de ellas contiene la grabación de una persona mientras duerme con una duración promedio de 7 hs. Estas señales se registraron a una frecuencia de muestreo de 100Hz por medio del sistema médico Apnealink el cual realiza un análisis de la señal generando un archivo de extensión CSV, donde el propio sistema etiqueta los eventos de ronquidos indicando la hora en que se producen.  Mediante este archivo se pudo localizar en la señal los momentos de ronquidos y extraer algunos segmentos de ellos para poder analizarlos. 

De acuerdo a la extracción y análisis de distintos segmentos, se pudo observar que estos contienen una serie de concentraciones de energía separados entre sí, de manera que presentan cierta repetitividad o periodicidad, tal como se aprecia en el segmento de la Figura \ref{figura:segmento_1_minuto}.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\columnwidth]{img/figure1}	
	\caption{Segmento de 1 minuto etiquetado como ronquidos.}
	\label{figura:segmento_1_minuto}
\end{figure}

Dada la baja resolución que presenta la señal en cuestión (100Hz) resulta imposible extraer características frecuenciales como son la transformada de fourier, formantes, espectrogramas, entre otras, es por esto que se debió buscar alguna característica temporal que sea representativa de los ronquidos. En consecuencia surgió la idea de medir la periodicidad de los eventos de ronquidos recién expuestos, a través del $T_0$ (Período Fundamental), partiendo de la hipótesis de que aquellos segmentos que contienen sonidos no deseados (todo lo que no sea ronquido), no presentan este patrón repetitivo, permitiendo así poder hacer uso de ésta característica para diferenciarlos entre sí. Por otro lado la necesidad de solamente poder utilizar análisis temporal presenta la ventaja de generar un mayor ahorro de tiempo y capacidad de procesamiento por no realizar los cálculos frecuenciales permitiendo también utilizar señales de baja resolución lo que genera un menor costo de almacenamiento.

Con el fin de utilizar el $T_0$ para diferenciar segmentos de ronquidos de aquellos que no lo son, resulta necesario analizar si el $T_0$ es una característica representativa de los ronquidos, en el sentido de que deberían presentar cierta homogeneidad en los valores obtenidos de segmentos provenientes de diferentes señales. Es por esto que en las siguientes secciones se presentan los resultados obtenidos de extraer segmentos de ronquidos de diferentes duraciones y de distintas señales de ambos sexos a los cuales se les calculó el correspondiente $T_0$.


\section{Cálculo de $T_0$ y comparación entre segmentos de distintas señales}
Debido a que se dispone de señales de personas de ambos sexos resulta interesante realizar el análisis separadamente a fin de determinar si existen diferencias notables en los ronquidos producidos por hombres o mujeres ya que esto podría implicar la necesidad de indicar el género en la aplicación a desarrollar en esta tesis. 
Por otra parte se procedió a extraer segmentos de diferentes duraciones con el objetivo de determinar si la variación de la misma implica variaciones importantes en los valores de $T_0$ y así poder determinar un valor óptimo de duración del segmento. 


\subsection{Análisis de señales correspondientes a hombres}
En esta sección se presentan los resultados obtenidos de los análisis realizados a señales de hombres. Para ello se tomaron 5 señales *.EDF dejando algunas señales para las pruebas finales del método. Para cada una de estas señales se extrajeron manualmente 5 segmentos de cada una de las siguientes duraciones: 30 segundos, 1, 2, 3 y 5 minutos. Posteriormente por medio de un script desarrollado en Matlab el cual utiliza el método de autocorrelación se calculó para cada uno de estos segmentos su valor de $T_0$ y su inversa F0 (frecuencia fundamental). En la Figura \ref{figura:segmento_ronquido_autocorr} se encuentra representado en la parte superior un segmento de 1 minuto el cual contiene ronquidos y en la parte inferior su correspondiente autocorrelación. 
Se puede observar en la Figura \ref{figura:segmento_ronquido_autocorr} de la autocorrelación la existencia de un valor pico en torno a los 4 segundos correspondiente al $T_0$ de los ronquidos contenidos en el segmento. 

\begin{figure}[H]
	\includegraphics[width=1\columnwidth]{img/figure2}	
	\caption{Segmento con ronquidos y su autocorrelación.}
	\label{figura:segmento_ronquido_autocorr}
\end{figure}

Como primer punto se analiza que sucede con los $T_0$ entre segmentos de una misma señal. En el Cuadro \ref{tabla:t0_f0_1_minuto} podemos ver los valores del $T_0$ y $F_0$ de 5 segmentos de ronquidos de 1 minuto de duración todos extraídos de la misma señal en diferentes momentos. Si se observa el valor del Desvío Estándar para los $T_0$ de los segmentos con ronquidos presentados en el Cuadro \ref{tabla:t0_f0_1_minuto}, se puede observar que tiene un valor de 0.46 segundos lo cual es un valor pequeño que estaría indicando cierta homogeneidad. 

Debido a que se extrajeron segmentos de distintas señales se puede observar en el Cuadro \ref{tabla:desvios_estandar_t0} los valores del Desvío Estándar de los $T_0$ de cada señal y para cada duración de segmentos. Viendo estos datos se concluye que cualquiera sea la duración utilizada en los segmentos, los valores del desvío estándar son menores a 1 segundo, con lo cual se está asegurando que la característica $T_0$ es homogénea entre segmentos de ronquidos de una misma señal.

Siguiendo el análisis se observa ahora que sucede con los valores del $T_0$ entre segmentos extraídos de diferentes señales, ya que si bien esta característica presentaba cierta homogeneidad entre los segmentos de una misma señal, podrían existir severas diferencias con segmentos provenientes de distintas señales y por ende de distintas personas y así no se podría generalizar el uso del $T_0$ como detector de ronquidos. Para ello se calculó el valor de la media y el desvío estándar de los $T_0$ de todos los segmentos de 1 minuto de duración independientemente de la señal a la que pertenezcan. En el Cuadro \ref{tabla:segmentos_1_minuto_hombres} se presentan los valores del $T_0$ de todos los segmentos de 1 minuto de duración seguidos de su media y desvío estándar, mientras que en el Cuadro \ref{tabla:media_desvio_t0_dist_duraciones} se presentan las medias y desvíos estándar de los $T_0$ de todos los segmentos de cada una de las duraciones.

Se puede observar en el Cuadro \ref{tabla:media_desvio_t0_dist_duraciones} que las medias son todas cercanas a los 4 segundos y que los desvíos estándar son inferiores a 1 segundo. Esto permite asegurar que la característica es representativa, no solo dentro de los segmentos de ronquidos de una misma señal, sino también entre segmentos de distintas señales, por lo que no existirían problemas en la distinción vía ésta característica usando cualquier grabación, siempre y cuando los valores de $T_0$ en los segmentos de ruidos difieran suficientemente como para distinguirlos, este aspecto se analizará en secciones posteriores.

Por último, se hace una evaluación acerca de la duración más apropiada de los segmentos. Como recientemente se ha mencionado y, como se podía observar en el Cuadro \ref{tabla:media_desvio_t0_dist_duraciones}, los valores de las medias y los desvíos de todos los segmentos de ronquidos tomando distintas duraciones resultan similares entre si, por lo tanto, se concluye que la duración óptima a utilizar, será la de 5 minutos, ya que se genera un ahorro en tiempo de procesamiento y cálculo. También es importante explicar que no se consideran tamaños de segmentos de mayor duración, ya que a los efectos de llevar esto a una aplicación que sea capaz de etiquetar los momentos donde se producen ronquidos, al tomar duraciones de 8, 10 o más minutos se estaría perdiendo precisión en el presente análisis.

\subsection{Análisis de señales correspondientes a mujeres}
En esta sección se repetirán los análisis anteriores pero utilizando señales de mujeres. Para ello también se tomaron 5 señales *.EDF dejando algunas señales para las pruebas finales del método. Para cada una de estas señales se extrajeron manualmente 5 segmentos de ronquidos de cada una de las duraciones anteriores.
A fin de determinar si el $T_0$ resulta homogéneo entre segmentos de una misma señal se analiza a continuación que valores toma el $T_0$ entre segmentos extraídos de una misma señal.

En el Cuadro \ref{tabla:desv_estandar_t0_mujeres} se encuentran los valores de los desvíos estandar de todos los $T_0$ de los segmentos extraídos de cada paciente y para cada duración. Si se observan los desvíos estándar todos ellos tienen valores menores a 1 segundo, con lo cual se puede concluir que presentan cierta homogeneidad al igual que ocurría con los segmentos extraídos de las señales de hombres.  

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			Señal & \multicolumn{5}{|c|}{Desvio estandar del T0} \\
			\hline \hline
			& 1 min & 30 seg & 2 min & 3 min & 5 min \\ \hline
			Paciente 6 & 0.34 & 0.46 & 0.45 & 0.37 & 0.36 \\ \hline
			Paciente 7 & 0.56 & 0.43 & 0.28 & 0.34 & 0.46 \\ \hline
			Paciente 8 & 0.37 & 0.43 & 0.32 & 0.37 & 0.65 \\ \hline
			Paciente 9 & 0.25 & 0.27 & 0.21 & 0.21 & 0.21 \\ \hline
			Paciente 10 & 0.15 & 0.16 & 0.20 & 0.09 & 0.11 \\ \hline
		\end{tabular}
		\caption{Desvíos estándar de los $T_0$ de cada señal en distintas duraciones para mujeres.}
		\label{tabla:desv_estandar_t0_mujeres}
	\end{center}
\end{table}

A continuación se verifica que el $T_0$ resulta homogéneo entre segmentos de distintas señales. En el Cuadro \ref{tabla:media_desv_t0_mujeres} se encuentran los valores de las medias y desvíos estándar de los $T_0$ de los segmentos para cada duración sin tener en cuenta a que paciente pertenece. Analizando estos datos se puede ver que en todos los casos el valor del desvío está muy por debajo de 1 segundo, por esto se concluye que cualquiera sea la señal, los valores del $T_0$ resultan homogéneos, es decir, que la característica realmente es representativa de los segmentos con eventos de ronquidos.

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			Duración segmentos & Media & Desvío Estándar\\ 
			\hline \hline
			30 segundos & 4.32 & 0.51 \\ \hline
			1 minuto & 4.24 & 0.50 \\ \hline
			2 minutos & 4.36 & 0.49 \\ \hline
			3 minutos & 4.28 & 0.50 \\ \hline
			5 minutos & 4.40 & 0.52 \\ \hline
		\end{tabular}
		\caption{Medias y desvíos estándar de los $T_0$ para distintas duraciones en mujeres.}
		\label{tabla:media_desv_t0_mujeres}
	\end{center}
\end{table}

Tal como se concluyó en el caso de las señales de hombres, aquí también puede verse que la media, cualquiera sea la duración de los segmentos, oscila en torno a los 4.3 segundos y el desvío en torno a los 0.50 segundos, por lo que dado este bajo número también se opta por la duración de segmentos de 5 minutos como la más óptima en términos de procesamiento y precisión.


\section{Comparación de $T_0$ entre Hombres y Mujeres}

Finalizado el análisis de las señales de hombres y mujeres por separado, se realiza un análisis comparativo del $T_0$ promedio entre dichas señales. Debido a que tanto en el análisis de hombres como en el de mujeres se llegó a la conclusión, de que la duración más óptima de los segmentos es la de 5 minutos, la comparación entre media y desvío de los $T_0$ se realizó directamente con esta duración. 

En el Cuadro \ref{tabla:media_desv_t0_hombre_mujer}, se encuentran representados los valores de las medias y desvíos de los $T_0$ correspondientes a segmentos de 5 minutos, tanto de señales de hombres como de mujeres. 

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			Tipo de señal & Media (5 min) & Desvío Estándar (5 min)\\ 
			\hline \hline
			Hombres & 4.18 & 0.71 \\ \hline
			Mujeres & 4.40 & 0.52 \\ \hline
		\end{tabular}
		\caption{Media y desvío de los $T_0$ de hombres y mujeres.}
		\label{tabla:media_desv_t0_hombre_mujer}
	\end{center}
\end{table}

Se puede observar que los valores promedios en ambos casos (mujeres y hombres), son prácticamente similares y, los correspondientes desvíos estándar, indican también cierta similitud, aunque en el caso de los hombres son levemente mayores. De todas maneras esta pequeña diferencia, no implica inconvenientes a la hora de la detección. De esta manera se descarta la necesidad de que un usuario de la aplicación Android tenga que indicar el género antes de comenzar su uso.

\section{Análisis de sonidos no deseados (ruidos)}
Dentro de esta sección se describen los resultados obtenidos del análisis realizado a sonidos no deseados. Por sonido no deseado, debe entenderse como todo aquel sonido que se puede acoplar en una grabación en entornos cotidianos y, que no se trata de un ronquido. Es por ésto, que a los fines del presente trabajo, se consideran como ruidos los sonidos de vehículos, murmullos o personas hablando, música, etcétera.

Hasta el momento se demostró que los valores del $T_0$ para segmentos con ronquidos extraídos de diferentes señales tanto de mujeres como hombres, presentan cierta similitud permitiendo concluir que el $T_0$ es una característica representativa de los segmentos con ronquidos. De todas maneras, esto no es suficiente para poder utilizar esta característica en una aplicación que permita detectar estos segmentos diferenciandolos de aquellos que contienen solo ruidos. Esto se debe a que aquellos sonidos no deseados que se pudieran capturar durante la grabación podrían tener un $T_0$ similar que llegue a caer dentro del rango establecido para ser considerados como ronquidos.
Para ello se demostrará en la presente sección que bajo condiciones normales los sonidos no deseados que se pueden capturar por medio del micrófono de un dispositivo móvil presentan valores del $T_0$ fuera del rango representativo de los ronquidos.

Se comenzó capturando distintas señales por medio de dispositivos móviles como una tablet y dos celulares. Para esto se instaló en los dispositivos la aplicación Easy Voice Recorder por medio de la cual se grabaron archivos en formato .WAV. Estas grabaciones se llevaron a cabo en ambientes bajo condiciones normales durante las horas del día ya que es mayor la cantidad de ruidos presentes, todas se capturaron a una frecuencia de muestreo de 8000 Hz que es la mínima frecuencia de muestreo que admite la aplicación, pero fueron submuestreadas a 100Hz de manera que tengan igual frecuencia de muestreo que las EDF. Luego se analizaron manualmente con el software Audacity extrayendo segmentos de 1 y 5 minutos que contenían distintos ruidos, por ejemplo: sonidos de vehículos en la calle, personas hablando, ladridos de perros, música proveniente de una radio y sonido de máquinas de obreros trabajando.

En la parte superior de la Figura \ref{figura:ruido1_1_minuto} se puede observar un segmento de 1 minuto el cual contiene ruido ambiental, proveniente del exterior, tal como máquinas de personas trabajando, tráfico de vehículos y personas hablando, mientras que en la gráfica de la parte inferior se encuentra su autocorrelación. 
A su vez el segmento graficado en la Figura \ref{figura:ruido2_1_minuto} consiste del sonido de un vehículo que proviene de la calle, la Figura \ref{figura:ruido3_1_minuto} contiene el sonido de transito de vehículos proveniente del exterior, primero una motocicleta y luego un automóvil que estaciona y sale al cabo de un tiempo y la Figura \ref{figura:ruido4_1_minuto} contiene el sonido de dos perros ladrando, todas ellas acompañadas en la parte inferior de su correspondiente autocorrelación.

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure3}	
	\caption{Sonido de maquinas trabajando, personas hablando y vehículos.}
	\label{figura:ruido1_1_minuto}
\end{figure}

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure4}	
	\caption{Sonido de un automovil circulando.}
	\label{figura:ruido2_1_minuto}
\end{figure}

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure5}	
	\caption{Sonido de dos vehículos circulando.}
	\label{figura:ruido3_1_minuto}
\end{figure}

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure6}	
	\caption{Sonido de perros ladrando.}
	\label{figura:ruido4_1_minuto}
\end{figure}

Como se puede ver en las figuras \ref{figura:ruido1_1_minuto}, \ref{figura:ruido2_1_minuto}, \ref{figura:ruido3_1_minuto} y \ref{figura:ruido4_1_minuto}, en los cuatro gráficos de la autocorrelación (parte inferior) no existen en ellos la presencia de un valor pico que sobresalga del resto como si sucede en los segmentos con ronquidos, donde claramente existe un valor pico correspondiente al $T_0$, esto se ve reflejado claramente en la comparación de las autocorrelaciones graficadas en la Figura \ref{figura:autocorrelacion_ruido_ronquidos}. Esto se debe a que en los segmentos con ronquidos, las señales presentan una naturaleza cuasi-periódica debido a la presencia de una serie de ronquidos de manera continua, y a que los mismos tienen una apariencia similar entre sí; ésto no ocurre en los ruidos antes analizados, donde tienden a concentrar su energía en un momento determinado (por ejemplo, el caso de vehículos).

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure7}	
	\caption{Autocorrelacion de ronquidos y autocorrelación de sonido ambiental.}
	\label{figura:autocorrelacion_ruido_ronquidos}
\end{figure}

Debido a que los segmentos analizados recientemente eran todos de 1 minuto de duración, y ya que se concluyo que la duración de 5 minutos era la mas óptima en el caso de segmentos con ronquidos, es que también se extrajeron segmentos de 5 minutos de sonidos no deseados. En las Figuras \ref{figura:ruido1_5minuto}, \ref{figura:ruido2_5minuto} y \ref{figura:ruido3_5minuto} se ven representados los mismos con su correspondiente autocorrelación. 

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure8}	
	\caption{Sonido de un automovil circulando en 5 minutos.}
	\label{figura:ruido1_5minuto}
\end{figure}

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure9}	
	\caption{Sonido de dos vehículos circulando en 5 minutos.}
	\label{figura:ruido2_5minuto}
\end{figure}

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure10}	
	\caption{Sonido de dos vehículos circulando y ladridos de perros en 5 minutos.}
	\label{figura:ruido3_5minuto}
\end{figure}

Tomando duraciones de 5 minutos se puede ver que en algunos segmentos se juntan distintos sonidos no deseados que antes (segmentos de 1 minuto de duración) se trataron separadamente como se puede ver en la Figura \ref{figura:ruido3_5minuto}. Esto es interesante para ver que sucede con el $T_0$ en segmentos con muchos y diferentes ruidos. 
Si se observan las gráficas de autocorrelación de las Figuras \ref{figura:ruido1_5minuto} y \ref{figura:ruido2_5minuto} se ve que el aumento del tamaño del segmento no implica cambios ya que no se observa ningún pico sobresaliente, lo mismo sucede para el caso de la Figura \ref{figura:ruido3_5minuto} que contiene distintos ruidos en un mismo segmento. Estos resultados permiten distinguir claramente estos segmentos de aquellos con ronquidos ya que los segmentos con ruidos no presentan un valor de $T_0$ sobresaliente en torno a los 4 segundos que era el valor promedio que se encontró en los segmentos con ronquidos. 

Debido a que se demostró que el $T_0$ es una característica representativa de los ronquidos tanto de mujeres como de hombres y que los análisis de segmentos de ruidos presentan valores del $T_0$ distinguibles se puede concluir que el $T_0$ es una buena característica a utilizar para la detección de los segmentos con ronquidos pudiendo diferenciarlos de sonidos no deseados que puedan encontrarse en grabaciones en entornos cotidianos y así lograr la robustez que se necesita.

\section{Mejora a través de funciones de recorte}
La utilización de funciones de recorte permite acentuar los máximos temporales de la señal (correspondientes al periodo fundamental), de forma que la discriminación del período fundamental se visualice con mayor claridad en el tramo analizado.

En la Figura \ref{figura:funciones_recorte}, se observan tres funciones de recorte diferentes. Donde CL es el umbral de decisión donde aplicar el descarte, y el eje x representa el valor de la muestra del segmento al que se le aplica el recorte.

A efectos de decidir cuál de las funciones de recortes antes descritas tiene mejor desempeño, se procedió a calcular la autocorrelación para un segmento con ronquidos, tras aplicar a dicho segmento cada una de las funciones de recorte por separado. En la Figura \ref{figura:autocor_funciones_recorte} se muestra una gráfica con los tres resultados posibles tras aplicar cada una de las funciones de recortes, claramente se puede visualizar que la función de recorte 3 es la que arroja los mejores resultados ya que se observan mas resaltados los picos que produce la autocorrelación ($T_0$, 2$T_0$, 3$T_0$, etcétera). Para los casos que se observaron recientemente, el valor del umbral CL se calculó tomando el 10\% del máximo valor del segmento. De esta manera la función de recorte anulará todas las muestras del segmento cuyo valor esté debajo del 10\% del valor máximo, para así fortalecer o dar más importancia a los valores temporales máximos. De todas maneras el valor óptimo del umbral CL se determina en etapas posteriores cuando se evalúa el algoritmo detector.


\begin{figure}[H]
	\centering
		\includegraphics[scale=0.6]{img/figure11}	
	\caption{Funciones de recorte}
	\label{figura:funciones_recorte}
\end{figure}

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure12}	
	\caption{Autocorrelaciones aplicando las tres funciones de recorte}
	\label{figura:autocor_funciones_recorte}
\end{figure}

En la Figura \ref{figura:autocor_funciones_recorte2} se puede observar el efecto de realce producido por la función de recorte, en segmentos donde los valores pico para encontrar el $T_0$, no son visualmente claros. A su vez en la Figura \ref{figura:autocor_funciones_recorte3} se muestra el efecto producido al aplicar la función de recorte a segmentos de sonidos no deseados. Observando estas dos gráficas, es visible que tanto en el caso de ronquidos, como en el de ruidos (sonidos no deseados), el efecto producido por la función de recorte, acentúa valores correspondientes a los períodos $T_0$, logrando en los casos de ronquidos que aquellos casos donde no eran visibles con facilidad, se puedan observarse claramente. Además, es notorio que en los casos de ruidos, no hay existencia de picos destacándose y menos aún, no existe homogeneidad alguna con respecto a la forma que gráficamente produce la autocorrelación.


\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure13}	
	\caption{Autocorrelación de ronquidos sin y con función de recorte}
	\label{figura:autocor_funciones_recorte2}
\end{figure}

\begin{figure}[H]
	\centering
		\includegraphics[width=1\columnwidth]{img/figure14}	
	\caption{Autocorrelación de sonido ambiental sin y con función de recorte}
	\label{figura:autocor_funciones_recorte3}
\end{figure}

\section{Cantidad mínima de ronquidos por segmento}
A continuación se plantea el análisis de dos aspectos que pueden alterar la detección a través del $T_0$. Por un lado se analiza que efectos tiene en el valor del $T_0$ la existencia de subsegmentos que no contengan ronquidos contenidos en segmentos de mayor duración que si contienen ronquidos. Para demostrar el efecto se tomó un segmento de 5 minutos con ronquidos y se extrajeron subsegmentos de distintas duraciones, de 1,2,3 y 4 minutos que no contenían ronquidos. Luego se volvió a calcular el $T_0$ sin estos subsegmentos a fin de demostrar si esos subsegmentos sin ronquidos tienen algún tipo de implicación. Tal como se puede apreciar en el Cuadro \ref{tabla:subsegmentos_t0}, no hay inconvenientes ya que cualquiera sea su duración, es decir, si es de 1, 2, 3 o 4 minutos, el $T_0$ detectado es correcto, ya que prácticamente no presenta variaciones respecto al resultado global (de la señal completa). 

El otro aspecto consiste en determinar el mínimo indispensable de eventos necesarios para que el $T_0$ sea detectado sin sufrir grandes desvíos respecto de la media. 
Para ello se analizó una parte del segmento, en particular con una duración de 15 segundos, en los cuales había 4 episodios de ronquido presentes, luego se procedió a quitar de a un evento a la vez y volver a calcular el $T_0$ y así observar si presentan diferencias. Si se observa el Cuadro \ref{tabla:cantidad_minima_t0}, se puede concluir que la cantidad mínima de eventos necesarios para la correcta detección es de 2 ya que con un solo evento el $T_0$ da un valor de 2.58 segundos, lo cual esta por debajo de los 4 segundos promedio. 

En conclusión, no existe restricción alguna en cuanto a la duración de sub­segmentos sin ronquidos, siempre y cuando en alguna parte del segmento completo, existan  al menos 2 eventos de ronquido.  

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			$T_0$ & \textbf{Descripción}\\ 
			\hline \hline
			4.24 & Señal completa \\ \hline
			4.34 & Último minuto eliminado \\ \hline
			4.24 & Minuto 4 eliminado \\ \hline
			4.24 & Minuto 3 eliminado \\ \hline
			4.24 & Minuto 2 eliminado \\ \hline
			4.24 & Minuto 1 eliminado \\ \hline
			\hline
			4.19 & Últimos 2 minutos eliminados \\ \hline
			4.34 & Minutos 1 y 5 eliminados \\ \hline
			4.34 & Minutos 2 y 5 eliminados \\ \hline
			4.34 & Minutos 3 y 5 eliminados \\ \hline
			4.19 & Minutos 4 y 5 eliminados \\ \hline
			4.24 & Minutos 1 y 4 eliminados \\ \hline
			4.24 & Minutos 2 y 4 eliminados \\ \hline
			4.24 & Minutos 3 y 4 eliminados \\ \hline
            4.19 & Minutos 5 y 4 eliminados \\ \hline
			4.24 & Minutos 1 y 3 eliminados \\ \hline
			4.24 & Minutos 2 y 3 eliminados \\ \hline
			4.24 & minutos 1 y 2 eliminados \\ \hline
			\hline
			4.19 & Últimos 3 minutos eliminados \\ \hline
			4.24 & Minutos 1,2,3 \\ \hline
			4.24 & Minutos 2,3,4 \\ \hline
			4.19 & Minutos 3,4,5 \\ \hline
			\hline
			4.50 & Últimos 4 minutos eliminados \\ \hline
			4.24 & Minutos 1,2,3 y 4 \\ \hline
		\end{tabular}
		\caption{T0 de segmentos eliminando subsegmentos sin ronquidos.}
		\label{tabla:subsegmentos_t0}
	\end{center}
\end{table}

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			$T_0$ & \textbf{Descripción}\\ 
			\hline \hline
			4.24 & Últimos 15 segundos \\ \hline
			4.24 & Últimos 15 segundos (contiene 4 eventos de ronquido) \\ \hline
			4.24 & Últimos 15 segundos con 3 eventos \\ \hline
			4.12 & Últimos 15 segundos con 2 eventos \\ \hline
			2.58 & Últimos 15 segundos con 1 eventos \\ \hline
		\end{tabular}
		\caption{Mínima cantidad de eventos por segmento.}
		\label{tabla:cantidad_minima_t0}
	\end{center}
\end{table}    

\section{Tasas de aciertos del método en Matlab}
Debido a que se utilizó Matlab para calcular el  T0 de los segmentos extraídos de las señales EDF, es que surge la posibilidad de desarrollar un script en Matlab, que sirva a modo de aplicación de referencia, que recorra una señal tomando frames de 5 minutos de duración y que calculando el T0 determine si el segmento poseé ronquidos.

Mediante los resultados que se obtuvieron utilizando este script, se pudo determinar que el método es aplicable antes de realizar la aplicación definitiva sobre la plataforma Android, al mismo tiempo que se pudo comparar estos resultados a fin de validar el correcto desarrollo en Android de funciones como la autocorrelación, que en Matlab ya se encuentran disponibles (como por ejemplo la función xcorr).

En el Cuadro \ref{tabla:clasificador_matlab} se presentan los resultados que se obtuvieron usando la función de recorte 3 con el umbral seteado en 2.3, cantidad mínima de ronquidos por segmento en 2 y el rango del T0 para ser ronquido entre [3.05s - 5.90 s]. En las distintas columnas se encuentran los valores de verdaderos positivos, verdaderos negativos, falsos positivos, falsos negativos, valor predictivo positivo, valor predictivo negativo, sensibilidad y especificidad, calculados para cada una de las señales EDF utilizadas hasta el momento.

A fin de analizar el desempeño del algoritmo se revisan a continuación los casos de falsos negativos y falsos positivos, analizando los valores de T0 presentados.

En el Cuadro \ref{tabla:falsos_negativos_matlab} se listan algunos valores de falsos negativos, correspondientes a los pacientes 1, 4, 7 y 9.
Observando estos T0, se puede ver que los mismos tienen valores inferiores a los 3 segundos, por lo tanto estos valores caen fuera del rango [3.05-5.90s] utilizado por el algoritmo para etiquetarlos como segmentos con ronquidos, de todas maneras representan una minoría.

En el Cuadro \ref{tabla:falsos_positivos_matlab}, se muestran algunos de los falsos positivos que se detectaron con el algoritmo, correspondientes a los pacientes 1, 6, 8 y 9. Como se puede apreciar, presentan valores de T0 similares a los segmentos con ronquidos. De los análisis puntuales realizados, fue notorio que la señal EDF en esos segmentos sin estar etiquetados como ronquidos presentan algunos picos aislados, esto se ve en algunas señales en mayor proporción que en otras, como el caso del paciente 9. Debido a esto el algoritmo los detecta como ronquidos. Igual que en el punto anterior y debido a que es un fenómeno presentado en algunas señales se tendrá en cuenta en la aplicación final Android, ya que a la hora de capturar las muestras desde un dispositivo estos ``picos'' aislados no deberían aparecer.

Una vez analizados los valores de falsos positivos y falsos negativos con las señales trabajadas hasta el momento, se procedió a determinar tasas de aciertos usando señales no utilizadas en pruebas (no vistas por el sistema). En el Cuadro \ref{tabla:clasificador_matlab_verificacion} se presentan los valores obtenidos para estas señales (verificación), en ellos se puede observar que los valores de sensibilidad y especificidad superan el 80\%, llegando en algunos casos muy cerca del 100\%, por lo tanto se puede concluir que el método utilizando señales limpias es factible y que puede ser implementado en lenguaje Android.


\chapter{Desarrollo de aplicación Android}
\thispagestyle{empty}
\section{Análisis y definición de requerimientos}
\subsection{Requerimientos funcionales}
\subsection{Requerimientos no funcionales}

\section{Diseño del sistema y del software}
\subsection{Casos de Uso}
\subsection{Diagramas de secuencia}
\subsection{Diseño de Clases}

\section{Integración y prueba del sistema}

\section{Optimizaciones de la aplicación Android}

\section{Tasas de aciertos aplicación Android}


\chapter{Conclusión y Trabajos Futuros}
\thispagestyle{empty}
\chapter*{Bibliografia}
\thispagestyle{empty}
\addcontentsline{toc}{chapter}{Bibliografía} % esto añade el capitulo en el índice
[1] PNEUMOWIKI, a enciclopedia de Neumología de contenido libre [consulta: 26 abril 2013]. Disponible en: \url{<http://es.pneumowiki.org/mediawiki/index.php?title=Ronquido>}

[2] RONCAR.ES, el ronquido simple y la apnea del sueño [consulta: 26 abril 2013]. Disponible en: \url{<http://roncopatia.roncar.es/>}

[3] MEDLINE PLUS, un servicio de salud para usted [consulta: 27 abril 2013]. Disponible en: \url{<http://www.nlm.nih.gov/medlineplus/spanish/snoring.html>}

[4] NIH, U.S. National Library of Medicine [consulta: 27 abril 2013]. Disponible en: \url{<http://www.nlm.nih.gov/>}

[5] ORTHOAPNEA, la solucion a los trastornos del sueño [consulta: 27 abril 2013]. Disponible en: \url{<http://www.orthoapnea.com/es/index.php>}
 
[6] GOOGLE PLAY, aplicaciones de Android [consulta: 30 abril 2013]. Disponible en: \url{<https://play.google.com/store>}

[7] iPHONE, cientos de miles de infitas posibilidades [consulta: 30 abril 2013]. Disponible en: \url{<http://www.apple.com/es/iphone/from-the-app-store/>}
 
[8] STARRY NIGTH, sleep technology bed [consulta: 30 abrir 2013]. Disponible en: \url{<http://www.starrynightbed.com/>}

[9] BACK IN ACTION, snore pillow [consulta: 30 abril 2013]. Disponible en: \url{<http://www.backinaction.co.uk/snore-pillow>}

[10] MILONE, D., RUFINER, H., ACEVEDO, R., DI PERSIA, L., TORRES, H. Introducción a las Señales y los Sistemas Discretos. Santa Fe, 2009. 223 p. 

[11] ENGELBRECHT, Andries P., Computational Intelligence, An Introduction 2nd Ed. South Africa, 2007. 630 p.

[12] WIKIPEDIA, la enciclopedia libre [consulta: 14 marzo 2016]. Disponible en: \url{https://es.wikipedia.org/wiki/Desarrollo_de_programas_para_Android}

[13] WIKIPEDIA, la enciclopedia libre [consulta: 14 marzo 2016]. Disponible en: \url{https://es.wikipedia.org/wiki/Java_(lenguaje_de_programacion)}

[14] WIKIPEDIA, la enciclopedia libre [consulta: 14 marzo 2016]. Disponible en: \url{https://es.wikipedia.org/wiki/Kit_de_desarrollo_de_software}

[15] José Antonio Fiz Fernández, Jordi Solá Soler y Raimon Jané Campos. Métodos de análisis del ronquido. Medicina Clínica (Barcelona). Elsevier. 2011.  

[16] Dirk Pevernagie, Ronald M. Aarts y Micheline De Meyer. The acoustics of snoring. Sleep Medicine Reviews. Elsevier. 2010.

[17] Ali  Azarbarzina, Zahra  Moussavi. Snoring sounds variability as a signature of obstructive sleep apnea. Medical Engineering \& Physics. Elsevier. 2013.

[18] Andrew Keong Ng, Tong San Koh, Kathiravelu Puvanendran y Udantha Ranjith Abeyratne. Snore Signal Enhancement and Activity Detection via Translation-Invariant Wavelet Transform. Transactions on Biomedical Engineering. IEEE. 2008.

[19] Ali Azarbarzin y Zahra M. K. Moussavi. Automatic and Unsupervised Snore Sound Extraction From Respiratory Sound Signals. Transactions on Biomedical Engineering. IEEE. 2011.

[20] SnoreClock. Aplicación para detectar ronquidos [consulta: 18 noviembre 2015]. Disponible en: \url{<https://play.google.com/store/apps/details?id=de.ralphsapps.snorecontrol>}

[21] Dream Watcher - Anti Ronquidos. Aplicación para detectar ronquidos [consulta: 20 noviembre 2015]. Disponible en: \url{<https://play.google.com/store/apps/details?id=com.arcadexxi.dreamwatcher>}

\chapter*{Anexos}
\thispagestyle{empty}
\addcontentsline{toc}{chapter}{Anexos} % esto añade el capitulo en el índice
\addcontentsline{toc}{section}{Anexo A} % asi se añade una seccion al índice

\begin{table}[htbp]
	\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\hline
			\textbf{Ronquido} & \textbf{Hora} \footnotesize{(HH:MM:SS)} & \textbf{T0} \footnotesize{(s)} & \textbf{F0} \footnotesize{(Hz)} \\
			\hline
			1 & 03:33:59 & 4.15 & 0.24 \\ \hline
			2 & 02:12:12 & 4.68 & 0.21 \\ \hline
			3 & 02:11:04 & 4.86 & 0.21 \\ \hline
			4 & 03:24:43 & 3.96 & 0.25 \\ \hline
			5 & 04:33:24 & 3.79 & 0.26 \\ \hline
			\multicolumn{2}{|r|}{\textbf{Media}} & \textbf{4.29} & \textbf{0.23} \\ \hline
			\multicolumn{2}{|r|}{\textbf{Desvío Estándar}} & \textbf{0.46} & \textbf{0.023} \\ \hline
		\end{tabular}
		\caption{$T_0$ y $F_0$ de segmentos de 1 minuto de duración.}
		\label{tabla:t0_f0_1_minuto}
	\end{center}
\end{table}

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			\textbf{Señal} & \multicolumn{5}{c|}{\textbf{Desvio estandar del T0}} \\
			\hline
			& 30 seg & 1 min & 2 min & 3 min & 5 min \\ \hline
			Paciente 1 & 0.47 & 0.46 & 0.46 & 0.43 & 0.24 \\ \hline
			Paciente 2 & 0.22 & 0.35 & 0.27 & 0.14 & 0.31 \\ \hline
			Paciente 3 & 0.12 & 0.25 & 0.20 & 0.21 & 0.26 \\ \hline
			Paciente 4 & 0.61 & 0.52 & 0.62 & 0.70 & 0.85 \\ \hline
			Paciente 5 & 0.24 & 0.09 & 0.17 & 0.17 & 0.08 \\ \hline
		\end{tabular}
		\caption{Desvíos estándar de los $T_0$ de cada señal en distintas duraciones.}
		\label{tabla:desvios_estandar_t0}
	\end{center}
\end{table}

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			\textbf{Señal} & \textbf{Hora Inicio} & \textbf{T0} (s) & \textbf{F0} (Hz) \\ 
			\hline \hline
			Paciente 1 & 03:33:59 & 4.15 & 0.24 \\ \hline
			& 02:12:12 & 4.68 & 0.21 \\ \hline
			& 02:11:04 & 4.86 & 0.21 \\ \hline
			& 03:24:43 & 3.96 & 0.25 \\ \hline
			& 04:33:24 & 3.79 & 0.26 \\ \hline
			Paciente 2 & 22:25:37 & 3.52 & 0.28 \\ \hline
			& 22:28:24 & 3.73 & 0.27 \\ \hline
			& 22:30:03 & 4.15 & 0.24 \\ \hline
			& 22:52:37 & 3.22 & 0.31 \\ \hline
			& 23:16:03 & 3.82 & 0.26 \\ \hline
			Paciente 3 & 01:43:47 & 3.77 & 0.27 \\ \hline
			& 02:06:04 & 4.26 & 0.23 \\ \hline
			& 02:31:09 & 3.95 & 0.25 \\ \hline
			& 03:10:34 & 3.58 & 0.28 \\ \hline
			& 04:52:01 & 3.93 & 0.25 \\ \hline
			Paciente 4 & 01:30:03 & 5.83 & 0.17 \\ \hline
			& 03:48:38 & 4.92 & 0.20 \\ \hline
			& 03:53:09 & 4.74 & 0.21 \\ \hline
			& 22:25:30 & 4.88 & 0.20 \\ \hline
			& 00:28:31 & 4.46 & 0.22 \\ \hline
			Paciente 5 & 04:21:07 & 3.90 & 0.2564 \\ \hline
			& 04:22:42 & 3.91 & 0.2558 \\ \hline
			& 04:57:37 & 3.82 & 0.2618 \\ \hline
			& 23:11:57 & 3.77 & 0.2653 \\ \hline
			& 23:42:54 & 3.68 & 0.2717 \\ \hline
			\multicolumn{2}{|r|}{\textbf{Media}} & \textbf{4.13} & \textbf{0.24} \\ \hline
			\multicolumn{2}{|r|}{\textbf{Desvío}} & \textbf{0.58} & \textbf{0.0319} \\ \hline
		\end{tabular}
		\caption{$T_0$ y $F_0$ de segmentos con ronquidos de 1 minuto en distintas señales de hombres.}
		\label{tabla:segmentos_1_minuto_hombres}
	\end{center}
\end{table}


\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			\textbf{Duración segmentos} & \textbf{Media} & \textbf{Desvío Estándar}\\ 
			\hline \hline
			30 segundos & 4.05 & 0.64 \\ \hline
			1 minuto & 4.13 & 0.58 \\ \hline
			2 minutos & 4.13 & 0.71 \\ \hline
			3 minutos & 4.11 & 0.69 \\ \hline
			5 minutos & 4.18 & 0.71 \\ \hline
		\end{tabular}
		\caption{Medias y desvíos estándar de los $T_0$ para distintas duraciones.}
		\label{tabla:media_desvio_t0_dist_duraciones}
	\end{center}
\end{table}

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|c|c|c|}
			\hline
			Señal & VP & VN & FP & FN & VPP & VPN & Sen & Esp \\ 
			\hline \hline
			Paciente 1 & 12 & 19 & 11 & 6 & 52.1\% & 76\% & 66.6\% & 63.3\% \\ \hline
			Paciente 2 & 46 & 0 & 0 & 2 & 100\% & 0\% & 95.8\% & --\\ \hline
			Paciente 3 & 42 & 3 & 0 & 3 & 100\% & 50\% & 93.3\% & 100\% \\ \hline
			Paciente 4 & 39 & 1 & 0 & 8 & 100\% & 11.1\% & 82.9\% & 100\% \\ \hline
			Paciente 5 & 28 & 18 & 1 & 1 & 96.5\% & 94.7\% & 96.5\% & 94.7\% \\ \hline
			Paciente 6 & 9 & 33 & 5 & 1 & 64.3\% & 97.6\% & 90\% & 86.8\% \\ \hline
			Paciente 7 & 38 & 1 & 0 & 9 & 100\% & 10\% & 80.8\% & 100\% \\ \hline
			Paciente 8 & 37 & 8 & 1 & 2 & 97.3\% & 80\% & 94.8\% & 88.8\% \\ \hline
			Paciente 9 & 7 & 19 & 12 & 10 & 36.8\% & 65.5\% & 41.1\% & 61.3\% \\ \hline
			Paciente 10 & 47 & 0 & 0 & 1 & 100\% & 0\% & 97.9\% & -- \\ \hline
		\end{tabular}
		\caption{Resultados de pruebas sobre clasificador/detector en Matlab.}
		\label{tabla:clasificador_matlab}
	\end{center}
\end{table}    

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\hline
			Señal & HORA & ETIQUETA & T0 \\ 
			\hline \hline
			Paciente 1 & 22:35:01 & FN & 2.07 \\ \hline
								&	23:35:02 & FN &	2.65 \\ \hline
			Paciente 4 & 23:10:03 &	FN & 2.09 \\ \hline
							  & 23:20:27 & FN &	2.51 \\ \hline
			Paciente 7 & 23:35:0 & FN & 2.14 \\ \hline
								&	01:00:11 & FN &	2.06 \\ \hline
		  Paciente 9 & 22:55:56 & FN & 2.33 \\ \hline
								&	23:00:19 & FN & 2.77 \\ \hline
		\end{tabular}
		\caption{Análisis de falsos negativos.}
		\label{tabla:falsos_negativos_matlab}
	\end{center}
\end{table}

\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\hline
			Señal & HORA & ETIQUETA & T0 \\ 
			\hline \hline
			Paciente 1 & 22:40:02 & FP & 4.11 \\ \hline
								 & 23:30:00 & FP & 5.68 \\ \hline
			Paciente 6 & 12:05:03	& FP & 4.29 \\ \hline
							   & 15:30:10 & FP & 4.68 \\ \hline
			Paciente 8 & 00:35:11 &	FP & 3.65 \\ \hline
		  Paciente 9 & 22:50:13 & FP & 4.66 \\ \hline
								 & 00:25:02 & FP & 3.96 \\ \hline
		\end{tabular}
		\caption{Análisis de falsos positivos.}
		\label{tabla:falsos_positivos_matlab}
	\end{center}
\end{table}


\begin{table}[H]
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|c|c|c|c|}
			\hline
			Señal & VP & VN & FP & FN & VPP & VPN & Sen & Esp \\ 
			\hline \hline
			Paciente 11 & 20 & 21 & 4 & 3 & 83.3\% & 87.5\% & 86.9\% & 84\% \\ \hline
			Paciente 12 & 9 & 36 & 1 & 2 & 90\% & 94.7\% & 81.8\% & 97.3\% \\ \hline
			Paciente 13 & 6 & 35 & 6 & 1 & 50\% & 97.2\% & 85.7\% & 85.3\% \\ \hline
			Paciente 14 & 9 & 30 & 7 & 2 & 43.7\% & 93.8\% & 81.8\% & 81.1\% \\ \hline
			Paciente 15 & 4 & 40 & 4 & 0 & 50\% & 100\% & 100\% & 90.9\% \\ \hline			
		\end{tabular}
		\caption{Verificación de métodos y funcionalidades de Matlab con señales no vistas.}
		\label{tabla:clasificador_matlab_verificacion}
	\end{center}
\end{table}  














\addcontentsline{toc}{section}{Anexo B}

\end{document}